# TODO: –°–µ—Ä–≤–µ—Ä–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥ –∑ –≥—ñ–±—Ä–∏–¥–Ω–∏–º localCache

## ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ

### –§–∞–∑–∞ 1: –£—Ç–∏–ª—ñ—Ç–∏ –∫–µ—à—É–≤–∞–Ω–Ω—è (src/lib/cache.ts)

- [x] 1.1. –°—Ç–≤–æ—Ä–∏—Ç–∏ –∫–ª–∞—Å HybridCache –∑ TTL –ø—ñ–¥—Ç—Ä–∏–º–∫–æ—é
- [x] 1.2. –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –º–µ—Ç–æ–¥–∏ get/set/delete –∑ —á–∞—Å–æ–º –∂–∏—Ç—Ç—è
- [x] 1.3. –î–æ–¥–∞—Ç–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫—É –æ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º—É (stale-while-revalidate)
- [x] 1.4. –Ü–Ω—Ç–µ–≥—Ä—É–≤–∞—Ç–∏ –∑ localStorage

### –§–∞–∑–∞ 2: –£—Ç–∏–ª—ñ—Ç–∏ –æ–ø—Ç–∏–º—ñ—Å—Ç–∏—á–Ω–∏—Ö –æ–Ω–æ–≤–ª–µ–Ω—å (src/lib/optimistic.ts)

- [x] 2.1. –°—Ç–≤–æ—Ä–∏—Ç–∏ –∫–ª–∞—Å OptimisticUpdateManager
- [x] 2.2. –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –º–µ—Ç–æ–¥–∏ add/remove/rollback
- [x] 2.3. –î–æ–¥–∞—Ç–∏ —É—Ç–∏–ª—ñ—Ç–∏ –¥–ª—è —Ä–µ–π—Ç–∏–Ω–≥—É, —É–ª—é–±–ª–µ–Ω–∏—Ö, –≤–∏–¥–∞–ª–µ–Ω–Ω—è, –¥–æ–¥–∞–≤–∞–Ω–Ω—è

### –§–∞–∑–∞ 3: –û–Ω–æ–≤–ª–µ–Ω–Ω—è API —Å–µ—Ä–≤—ñ—Å—É (src/services/api.ts)

- [x] 3.1. –Ü–Ω—Ç–µ–≥—Ä—É–≤–∞—Ç–∏ HybridCache –≤ —ñ—Å–Ω—É—é—á–∏–π api.ts
- [x] 3.2. –î–æ–¥–∞—Ç–∏ –∫–µ—à—É–≤–∞–Ω–Ω—è –¥–ª—è getAll –∑–∞–ø–∏—Ç—ñ–≤
- [x] 3.3. –î–æ–¥–∞—Ç–∏ –∫–µ—à—É–≤–∞–Ω–Ω—è –¥–ª—è getById –∑–∞–ø–∏—Ç—ñ–≤
- [x] 3.4. –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –æ–ø—Ç–∏–º—ñ—Å—Ç–∏—á–Ω—ñ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –¥–ª—è –º—É—Ç–∞—Ü—ñ–π
- [x] 3.5. –î–æ–¥–∞—Ç–∏ —É—Ç–∏–ª—ñ—Ç–∏ cacheUtils –¥–ª—è —ñ–Ω–≤–∞–ª—ñ–¥–∞—Ü—ñ—ó

### –§–∞–∑–∞ 4: –û–ø—Ç–∏–º—ñ—Å—Ç–∏—á–Ω—ñ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö

- [x] 4.1. –û–Ω–æ–≤–∏—Ç–∏ CardsContent.tsx –¥–ª—è –æ–ø—Ç–∏–º—ñ—Å—Ç–∏—á–Ω–∏—Ö –æ–Ω–æ–≤–ª–µ–Ω—å
- [x] 4.2. –û–Ω–æ–≤–∏—Ç–∏ WineCard.tsx –¥–ª—è –æ–ø—Ç–∏–º—ñ—Å—Ç–∏—á–Ω–æ–≥–æ —Ä–µ–π—Ç–∏–Ω–≥—É
- [x] 4.3. –û–Ω–æ–≤–∏—Ç–∏ WineCard.tsx –¥–ª—è –æ–ø—Ç–∏–º—ñ—Å—Ç–∏—á–Ω–∏—Ö —É–ª—é–±–ª–µ–Ω–∏—Ö
- [x] 4.4. –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ fallback –Ω–∞ –∫–µ—à –ø—Ä–∏ –ø–æ–º–∏–ª–∫–∞—Ö –º–µ—Ä–µ–∂—ñ

### –§–∞–∑–∞ 5: –û–Ω–æ–≤–ª–µ–Ω–Ω—è FavoritesPage

- [x] 5.1. –û–Ω–æ–≤–∏—Ç–∏ favorites/page.tsx –∑ –∫–µ—à—É–≤–∞–Ω–Ω—è–º
- [x] 5.2. –î–æ–¥–∞—Ç–∏ –æ–ø—Ç–∏–º—ñ—Å—Ç–∏—á–Ω–µ –≤–∏–¥–∞–ª–µ–Ω–Ω—è —É–ª—é–±–ª–µ–Ω–∏—Ö

### –§–∞–∑–∞ 6: –û–Ω–æ–≤–ª–µ–Ω–Ω—è CommentsSection

- [x] 6.1. –û–Ω–æ–≤–∏—Ç–∏ CommentsSection.tsx –∑ –∫–µ—à—É–≤–∞–Ω–Ω—è–º
- [x] 6.2. –î–æ–¥–∞—Ç–∏ –æ–ø—Ç–∏–º—ñ—Å—Ç–∏—á–Ω–µ –¥–æ–¥–∞–≤–∞–Ω–Ω—è –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤
- [x] 6.3. –î–æ–¥–∞—Ç–∏ –æ–ø—Ç–∏–º—ñ—Å—Ç–∏—á–Ω–µ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤

### –§–∞–∑–∞ 7: Custom Hooks (src/lib/hooks.ts)

- [x] 7.1. useHybridCache - —Ö—É–∫ –¥–ª—è –≥—ñ–±—Ä–∏–¥–Ω–æ–≥–æ –∫–µ—à—É–≤–∞–Ω–Ω—è
- [x] 7.2. useOptimisticList - —Ö—É–∫ –¥–ª—è –æ–ø—Ç–∏–º—ñ—Å—Ç–∏—á–Ω–∏—Ö —Å–ø–∏—Å–∫—ñ–≤
- [x] 7.3. useOffline - —Ö—É–∫ –¥–ª—è –æ—Ñ–ª–∞–π–Ω —Å—Ç–∞—Ç—É—Å—É
- [x] 7.4. useCacheStats - —Ö—É–∫ –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–µ—à—É
- [x] 7.5. useDebouncedFilters - —Ö—É–∫ –¥–ª—è debounced —Ñ—ñ–ª—å—Ç—Ä—ñ–≤

---

## üìã –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –∫–µ—à—É

### TTL –∑–Ω–∞—á–µ–Ω–Ω—è (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º):

| –¢–∏–ø –¥–∞–Ω–∏—Ö | TTL   | –û–ø–∏—Å             |
| --------- | ----- | ---------------- |
| cards     | 5 —Ö–≤  | –°–ø–∏—Å–æ–∫ –∫–∞—Ä—Ç–æ–∫    |
| card      | 10 —Ö–≤ | –î–µ—Ç–∞–ª—ñ –∫–∞—Ä—Ç–∫–∏    |
| favorites | 2 —Ö–≤  | –£–ª—é–±–ª–µ–Ω—ñ –∫–∞—Ä—Ç–∫–∏  |
| comments  | 5 —Ö–≤  | –ö–æ–º–µ–Ω—Ç–∞—Ä—ñ        |
| user      | 1 –≥–æ–¥ | –î–∞–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ |
| default   | 5 —Ö–≤  | –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º |

### –ö–ª—é—á—ñ –∫–µ—à—É:

- `wine-cache:cards:{filters}:{page}` - —Å–ø–∏—Å–æ–∫ –∫–∞—Ä—Ç–æ–∫
- `wine-cache:card:{id}` - –¥–µ—Ç–∞–ª—ñ –∫–∞—Ä—Ç–∫–∏
- `wine-cache:favorites:all` - —É–ª—é–±–ª–µ–Ω—ñ –∫–∞—Ä—Ç–∫–∏
- `wine-cache:comments:{cardId}:{page}` - –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ
- `wine-cache:user:profile` - –ø—Ä–æ—Ñ—ñ–ª—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞

---

## üöÄ –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

### –û—Ç—Ä–∏–º–∞–Ω–Ω—è –∫–∞—Ä—Ç–æ–∫ –∑ –∫–µ—à–µ–º:

```typescript
import { cardsAPI } from "@/services/api";

const result = await cardsAPI.getAll(filters, { page: 1, limit: 10 });
// –î–∞–Ω—ñ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∫–µ—à—É—é—Ç—å—Å—è
```

### –û—á–∏—â–µ–Ω–Ω—è –∫–µ—à—É:

```typescript
import { cacheUtils } from "@/services/api";

// –û—á–∏—Å—Ç–∏—Ç–∏ –≤–µ—Å—å –∫–µ—à
cacheUtils.clearAll();

// –û—á–∏—Å—Ç–∏—Ç–∏ –∫–µ—à –∫–∞—Ä—Ç–æ–∫
cacheUtils.clearCards();

// –û—á–∏—Å—Ç–∏—Ç–∏ –∫–µ—à —É–ª—é–±–ª–µ–Ω–∏—Ö
cacheUtils.clearFavorites();

// –û—Ç—Ä–∏–º–∞—Ç–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
const stats = cacheUtils.getStats();
console.log(stats); // { size: 123, entries: 45, version: "1.0.0" }
```

### –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Ö—É–∫—ñ–≤:

```typescript
import { useHybridCache, useOptimisticList, useOffline } from "@/lib/hooks";

// –ì—ñ–±—Ä–∏–¥–Ω–µ –∫–µ—à—É–≤–∞–Ω–Ω—è
const { data, loading, isStale, refresh } = useHybridCache(
  "my-key",
  () => fetchData(),
  60000, // TTL –≤ –º—Å
);

// –û–ø—Ç–∏–º—ñ—Å—Ç–∏—á–Ω–∏–π —Å–ø–∏—Å–æ–∫
const { items, addOptimistic, removeOptimistic, mutate } = useOptimisticList(
  initialItems,
  async (id) => await deleteItem(id),
);

// –û—Ñ–ª–∞–π–Ω —Å—Ç–∞—Ç—É—Å
const isOffline = useOffline();
```

---

## üìù –ü–æ–ª—ñ—Ç–∏–∫–∞ –≤–µ—Ä—Å—ñ–æ–Ω—É–≤–∞–Ω–Ω—è

–ü—Ä–∏ –∑–º—ñ–Ω—ñ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –¥–∞–Ω–∏—Ö –∞–±–æ —Ñ–æ—Ä–º–∞—Ç—É –∫–µ—à—É:

1. –ó–±—ñ–ª—å—à–∏—Ç–∏ –≤–µ—Ä—Å—ñ—é –≤ `CACHE_VERSION` –≤ `cache.ts`
2. –í—Å—ñ –∑–∞—Å—Ç–∞—Ä—ñ–ª—ñ –∑–∞–ø–∏—Å–∏ –∫–µ—à—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ—á–∏—Å—Ç—è—Ç—å—Å—è

---

## üîß –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

### –ó–º—ñ–Ω–∞ TTL:

```typescript
import { hybridCache } from "@/lib/cache";

// –î–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–∏–ø—É
hybridCache.config.cardsTTL = 10 * 60 * 1000; // 10 —Ö–≤–∏–ª–∏–Ω

// –ü—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ
const customCache = new HybridCache({
  cardsTTL: 10 * 60 * 1000,
  cardDetailTTL: 15 * 60 * 1000,
});
```

### –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∏–π —Ä–æ–∑–º—ñ—Ä –∫–µ—à—É:

```typescript
const customCache = new HybridCache({
  maxCacheSize: 5 * 1024 * 1024, // 5MB
});
```
